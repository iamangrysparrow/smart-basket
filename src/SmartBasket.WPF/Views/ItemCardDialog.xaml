<Window x:Class="SmartBasket.WPF.Views.ItemCardDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:converters="clr-namespace:SmartBasket.WPF.Converters"
        Title="Карточка товара"
        Width="450" SizeToContent="Height"
        WindowStartupLocation="CenterOwner"
        ResizeMode="NoResize"
        ShowInTaskbar="False"
        Background="{DynamicResource BackgroundBrush}">

    <Grid Margin="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Item Name (read-only) -->
        <StackPanel Grid.Row="0">
            <TextBlock Text="Название товара:" Style="{StaticResource TextSecondary}" FontSize="10" Margin="0,0,0,2"/>
            <TextBlock x:Name="ItemNameText" Style="{StaticResource H2}" TextWrapping="Wrap"/>
        </StackPanel>

        <!-- Shop (read-only) -->
        <StackPanel Grid.Row="1" Margin="0,12,0,0">
            <TextBlock Text="Магазин:" Style="{StaticResource TextSecondary}" FontSize="10" Margin="0,0,0,2"/>
            <TextBlock x:Name="ShopText" Style="{StaticResource TextPrimary}"/>
        </StackPanel>

        <!-- Unit of Measure (read-only) -->
        <StackPanel Grid.Row="2" Margin="0,12,0,0">
            <TextBlock Text="Единица измерения:" Style="{StaticResource TextSecondary}" FontSize="10" Margin="0,0,0,2"/>
            <TextBlock x:Name="UnitText" Style="{StaticResource TextPrimary}"/>
        </StackPanel>

        <!-- Purchase Count (read-only) -->
        <StackPanel Grid.Row="3" Margin="0,12,0,0">
            <TextBlock Text="Количество покупок:" Style="{StaticResource TextSecondary}" FontSize="10" Margin="0,0,0,2"/>
            <TextBlock x:Name="PurchaseCountText" Style="{StaticResource TextPrimary}"/>
        </StackPanel>

        <!-- Product Selection (editable ComboBox with search) -->
        <StackPanel Grid.Row="4" Margin="0,16,0,0">
            <TextBlock Text="Связанный продукт:" Style="{StaticResource TextSecondary}" FontSize="10" Margin="0,0,0,4"/>

            <Grid>
                <ComboBox x:Name="ProductComboBox"
                          FontSize="12"
                          IsEditable="True"
                          IsTextSearchEnabled="False"
                          StaysOpenOnEdit="True"
                          MaxDropDownHeight="250"
                          PreviewTextInput="ProductComboBox_PreviewTextInput"
                          SelectionChanged="ProductComboBox_SelectionChanged"
                          DropDownOpened="ProductComboBox_DropDownOpened"
                          DropDownClosed="ProductComboBox_DropDownClosed">
                    <ComboBox.ItemTemplate>
                        <DataTemplate>
                            <TextBlock Text="{Binding DisplayName}" FontSize="11"/>
                        </DataTemplate>
                    </ComboBox.ItemTemplate>
                </ComboBox>

                <!-- Clear/Cancel button -->
                <Button x:Name="ClearButton"
                        HorizontalAlignment="Right"
                        VerticalAlignment="Center"
                        Margin="0,0,24,0"
                        Padding="4"
                        Cursor="Hand"
                        Click="ClearButton_Click"
                        Visibility="Collapsed"
                        Background="Transparent"
                        BorderThickness="0"
                        ToolTip="Отменить поиск">
                    <Path Data="{StaticResource IconCancel}"
                          Fill="{DynamicResource TextSecondaryBrush}"
                          Width="10" Height="10" Stretch="Uniform"/>
                </Button>
            </Grid>
        </StackPanel>

        <!-- Labels (read-only) -->
        <StackPanel Grid.Row="5" Margin="0,12,0,0">
            <TextBlock Text="Метки:" Style="{StaticResource TextSecondary}" FontSize="10" Margin="0,0,0,4"/>
            <WrapPanel x:Name="LabelsPanel" Orientation="Horizontal"/>
        </StackPanel>

        <!-- Buttons -->
        <StackPanel Grid.Row="6" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,16,0,0">
            <Button Content="Отмена" Style="{StaticResource SecondaryButton}"
                    IsCancel="True" Width="80" Margin="0,0,8,0"/>
            <Button Content="Сохранить" Style="{StaticResource PrimaryButton}"
                    Click="SaveButton_Click" Width="100"/>
        </StackPanel>
    </Grid>
</Window>
