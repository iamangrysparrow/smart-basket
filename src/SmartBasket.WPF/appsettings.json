{
  "Theme": "Light",
  "Database": {
    "Provider": "PostgreSQL",
    "ConnectionString": "Host=localhost;Port=5432;Database=smart_basket2;Username=postgres;Password=sloart"
  },
  "ReceiptSources": [
    {
      "Name": "Email (migrated)",
      "Type": 0,
      "Parser": "Auto",
      "IsEnabled": true,
      "Email": {
        "ImapServer": "imap.yandex.com",
        "ImapPort": 993,
        "UseSsl": true,
        "Username": "hsSparrow@yandex.ru",
        "Password": "enc:dGtvbmpkeHl4emh3Z3Zsbw==",
        "SenderFilter": "info@kuper.ru",
        "SubjectFilter": "собран",
        "Folder": "INBOX",
        "SearchDaysBack": 10
      }
    }
  ],
  "Parsers": [
    {
      "Name": "InstamartParser",
      "Type": 0,
      "RequiresAI": false,
      "AiProvider": null,
      "Description": "Парсер HTML-чеков от СберМаркет (Instamart)",
      "SupportedShops": [
        "СберМаркет",
        "Instamart",
        "sbermarket.ru"
      ],
      "SupportedFormats": [
        "html"
      ],
      "IsBuiltIn": true,
      "IsEnabled": true
    },
    {
      "Name": "LlmUniversalParser",
      "Type": 1,
      "RequiresAI": true,
      "AiProvider": null,
      "Description": "Универсальный AI-парсер для любых форматов чеков",
      "SupportedShops": [
        "*"
      ],
      "SupportedFormats": [
        "html",
        "text",
        "json"
      ],
      "IsBuiltIn": true,
      "IsEnabled": true
    }
  ],
  "AiProviders": [
    {
      "Key": "Ollama - deepseek-tool-calling",
      "Provider": 0,
      "Model": "MFDoom/deepseek-r1-tool-calling:8b",
      "BaseUrl": "http://localhost:11434",
      "Temperature": 0.2,
      "TimeoutSeconds": 300,
      "MaxTokens": 4000,
      "ApiKey": "",
      "FolderId": "",
      "AgentId": ""
    },
    {
      "Key": "YandexGPT",
      "Provider": 1,
      "Model": "yandexgpt",
      "BaseUrl": "http://localhost:11434",
      "Temperature": 0.1,
      "TimeoutSeconds": 300,
      "MaxTokens": 7000,
      "ApiKey": "enc:QVFWTnhKYk9ZNGt1cVlFd252RzZncXpvVUlrTThiQTQwMVhrczUxMg==",
      "FolderId": "b1guqdamskdmpgqb469g",
      "AgentId": ""
    },
    {
      "Key": "Ollama - mistral",
      "Provider": 0,
      "Model": "mistral:latest",
      "BaseUrl": "http://localhost:11434",
      "Temperature": 0.1,
      "TimeoutSeconds": 60,
      "MaxTokens": 4000,
      "ApiKey": "",
      "FolderId": "",
      "AgentId": ""
    },
    {
      "Key": "Ollama - qwen-7b",
      "Provider": 0,
      "Model": "qwen2.5-coder:7b",
      "BaseUrl": "http://localhost:11434",
      "Temperature": 0.2,
      "TimeoutSeconds": 300,
      "MaxTokens": 5000,
      "ApiKey": "",
      "FolderId": "",
      "AgentId": ""
    },
    {
      "Key": "YA Alice",
      "Provider": 3,
      "Model": "llama3.2:3b",
      "BaseUrl": "http://localhost:11434",
      "Temperature": 0.3,
      "TimeoutSeconds": 300,
      "MaxTokens": 7000,
      "ApiKey": "enc:QVFWTjJ3dmtwSVVQWW5lTTZ6dE1GQzZjRFV6UnRnNW5WX0lkdlFjdA==",
      "FolderId": "b1guqdamskdmpgqb469g",
      "AgentId": "fvtliorm4r0itstnpjsp"
    }
  ],
  "AiOperations": {
    "Classification": "YA Alice",
    "Labels": "Ollama - qwen-7b",
    "Chat": null,
    "Prompts": {
      "Chat": "Ты — ассистент для анализа покупок. У тебя есть доступ к базе данных чеков.\n\nСЕГОДНЯШНЯЯ ДАТА: {{TODAY}}\n\nДОСТУПНЫЕ ИНСТРУМЕНТЫ:\n\n1. describe_data — получить схему БД и примеры данных.\n   Вызови ОДИН РАЗ в начале, чтобы понять структуру.\n\n2. query — выполнить SQL SELECT запрос.\n   Параметры:\n   - table: Receipts | ReceiptItems | Items | Products | Labels | ItemLabels | ProductLabels\n   - columns: [\"Column\", \"Table.Column\"] — колонки для SELECT\n   - aggregates: [{function: \"COUNT|SUM|AVG|MIN|MAX\", column: \"*|Column\", alias: \"name\"}]\n   - joins: [{table: \"Table\", on: [\"Left.Col\", \"Right.Col\"], type: \"inner|left\"}]\n   - where: [{column, op, value}] — фильтры (AND)\n   - group_by: [\"Column\"] — группировка\n   - having: [{function, column, op, value}] — фильтр агрегатов\n   - order_by: [{column, direction}] — сортировка\n   - limit: число (макс 100)\n   \n   Операторы: =, !=, >, <, >=, <=, ILIKE, LIKE, IN, NOT IN, IS NULL, IS NOT NULL, BETWEEN\n\nПРИМЕРЫ:\n\nСколько чеков и на какую сумму:\n{\"table\": \"Receipts\", \"aggregates\": [{\"function\": \"COUNT\", \"column\": \"*\", \"alias\": \"total\"}, {\"function\": \"SUM\", \"column\": \"Total\", \"alias\": \"amount\"}]}\n\nТоп-5 товаров по сумме:\n{\"table\": \"ReceiptItems\", \"joins\": [{\"table\": \"Items\", \"on\": [\"Items.Id\", \"ReceiptItems.ItemId\"]}], \"columns\": [\"Items.Name\"], \"aggregates\": [{\"function\": \"SUM\", \"column\": \"ReceiptItems.Amount\", \"alias\": \"total\"}], \"group_by\": [\"Items.Name\"], \"order_by\": [{\"column\": \"total\", \"direction\": \"DESC\"}], \"limit\": 5}\n\nПоиск товаров:\n{\"table\": \"Items\", \"where\": [{\"column\": \"Name\", \"op\": \"ILIKE\", \"value\": \"%молоко%\"}]}\n\nПРАВИЛА:\n1. Если не знаешь структуру — вызови describe_data\n2. Используй JOIN для связей между таблицами\n3. Для поиска по части слова: ILIKE с %\n4. Даты в формате YYYY-MM-DD\n5. Отвечай кратко на русском языке",
      "Classification/YA Alice": "Ты — классификатор товаров для домашней бухгалтерии.\r\n\r\nТЕКУЩИЙ КАТАЛОГ ПРОДУКТОВ (JSON):\r\n{{EXISTING_HIERARCHY_JSON}}\r\n\r\nТОВАРЫ ДЛЯ КЛАССИФИКАЦИИ:\r\n{{ITEMS}}\r\n\r\nПРАВИЛА:\r\n1. Каждый товар ОБЯЗАТЕЛЬНО должен быть отнесён к конкретной категории продуктов\r\n2. ЗАПРЕЩЕНО использовать категории типа \"Не категоризировано\", \"Другое\", \"Прочее\", \"Разное\"\r\n3. Если подходящей категории нет — создай новую с понятным названием (Хлеб->Батон, Варенье)\r\n4. Используй существующие категории из каталога если они подходят\r\n\r\nВерни JSON:\r\n- products: новые категории (если нужны), каждая с name и parent\r\n- items: для каждого товара укажи name, product (категория) и path (путь в иерархии как массив)\r\n\r\nПример ответа:\r\n{\r\n  \"products\": [{\"name\": \"Йогурт\", \"parent\": \"Молочные продукты\"}],\r\n  \"items\": [{\"name\": \"Молоко Домик в деревне 2.5%\", \"product\": \"Молоко\", \"path\": [\"Молочные продукты\", \"Молоко\"]}]\r\n}",
      "Classification/YandexGPT": "Ты — классификатор товаров для домашней бухгалтерии.\r\n\r\nТЕКУЩИЙ КАТАЛОГ ПРОДУКТОВ (JSON):\r\n{{EXISTING_HIERARCHY_JSON}}\r\n\r\nТОВАРЫ ДЛЯ КЛАССИФИКАЦИИ:\r\n{{ITEMS}}\r\n\r\nВерни JSON:\r\n- products: новые категории (если нужны), каждая с name и parent\r\n- items: для каждого товара укажи name, product (категория) и path (путь в иерархии как массив)\r\n\r\nПример ответа:\r\n{\r\n  \"products\": [{\"name\": \"Йогурт\", \"parent\": \"Молочные продукты\"}],\r\n  \"items\": [{\"name\": \"Молоко Домик в деревне 2.5%\", \"product\": \"Молоко\", \"path\": [\"Молочные продукты\", \"Молоко\"]}]\r\n}"
    }
  },
  "Email": {
    "ImapServer": "imap.yandex.com",
    "ImapPort": 993,
    "UseSsl": true,
    "Username": "hsSparrow@yandex.ru",
    "Password": "enc:dGtvbmpkeHl4emh3Z3Zsbw==",
    "SenderFilter": "info@kuper.ru",
    "SubjectFilter": "собран",
    "Folder": "INBOX",
    "SearchDaysBack": 10
  },
  "Llm": null,
  "Ollama": {
    "BaseUrl": "http://localhost:11434",
    "Model": "MFDoom/deepseek-r1-tool-calling:8b",
    "Temperature": 0.1,
    "TimeoutSeconds": 300
  },
  "YandexGpt": null
}
