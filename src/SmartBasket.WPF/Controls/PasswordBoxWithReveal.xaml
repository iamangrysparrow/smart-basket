<UserControl x:Class="SmartBasket.WPF.Controls.PasswordBoxWithReveal"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             mc:Ignorable="d"
             d:DesignHeight="28" d:DesignWidth="200">

    <Border BorderBrush="{DynamicResource BorderBrush}"
            BorderThickness="1"
            CornerRadius="3"
            Background="{DynamicResource SurfaceBrush}">
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <!-- PasswordBox (masked) -->
            <PasswordBox x:Name="PasswordHidden"
                         Grid.Column="0"
                         PasswordChanged="PasswordHidden_PasswordChanged"
                         BorderThickness="0"
                         Background="Transparent"
                         Padding="4,2"
                         FontSize="12"
                         VerticalContentAlignment="Center"/>

            <!-- TextBox (visible) - binding only one-way, sync through code-behind -->
            <TextBox x:Name="PasswordVisible"
                     Grid.Column="0"
                     TextChanged="PasswordVisible_TextChanged"
                     BorderThickness="0"
                     Background="Transparent"
                     Padding="4,2"
                     FontSize="12"
                     VerticalContentAlignment="Center"
                     Visibility="Collapsed"/>

            <!-- Toggle Button (eye icon) -->
            <ToggleButton x:Name="RevealButton"
                          Grid.Column="1"
                          Width="24"
                          Height="24"
                          Margin="2"
                          Cursor="Hand"
                          Background="Transparent"
                          BorderThickness="0"
                          Checked="RevealButton_Checked"
                          Unchecked="RevealButton_Unchecked"
                          ToolTip="Показать/скрыть пароль">
                <ToggleButton.Style>
                    <Style TargetType="ToggleButton">
                        <Setter Property="Template">
                            <Setter.Value>
                                <ControlTemplate TargetType="ToggleButton">
                                    <Border Background="{TemplateBinding Background}"
                                            CornerRadius="2">
                                        <ContentPresenter HorizontalAlignment="Center"
                                                          VerticalAlignment="Center"/>
                                    </Border>
                                    <ControlTemplate.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter Property="Background" Value="{DynamicResource HoverBrush}"/>
                                        </Trigger>
                                    </ControlTemplate.Triggers>
                                </ControlTemplate>
                            </Setter.Value>
                        </Setter>
                    </Style>
                </ToggleButton.Style>
                <Grid>
                    <!-- Eye Open (password hidden) -->
                    <Path x:Name="EyeOpen"
                          Data="M12,4.5C7,4.5 2.73,7.61 1,12c1.73,4.39 6,7.5 11,7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5M12,17c-2.76,0-5-2.24-5-5s2.24-5 5-5 5,2.24 5,5-2.24,5-5,5m0-8c-1.66,0-3,1.34-3,3s1.34,3 3,3 3-1.34 3-3-1.34-3-3-3"
                          Fill="{DynamicResource TextSecondaryBrush}"
                          Width="14" Height="14"
                          Stretch="Uniform"/>
                    <!-- Eye Closed (password visible) -->
                    <Path x:Name="EyeClosed"
                          Data="M12,7c2.76,0 5,2.24 5,5 0,.65-.13,1.26-.36,1.83l2.92,2.92c1.51-1.26 2.7-2.89 3.43-4.75-1.73-4.39-6-7.5-11-7.5-1.4,0-2.74.25-3.98.7l2.16,2.16C10.74,7.13 11.35,7 12,7M2,4.27l2.28,2.28.46.46C3.08,8.3 1.78,10.02 1,12c1.73,4.39 6,7.5 11,7.5 1.55,0 3.03-.3 4.38-.84l.42.42L19.73,22 21,20.73 3.27,3 2,4.27zM7.53,9.8l1.55,1.55c-.05.21-.08.43-.08.65 0,1.66 1.34,3 3,3 .22,0 .44-.03.65-.08l1.55,1.55c-.67.33-1.41.53-2.2.53-2.76,0-5-2.24-5-5 0-.79.2-1.53.53-2.2zm4.31-.78l3.15,3.15.02-.16c0-1.66-1.34-3-3-3l-.17.01z"
                          Fill="{DynamicResource TextSecondaryBrush}"
                          Width="14" Height="14"
                          Stretch="Uniform"
                          Visibility="Collapsed"/>
                </Grid>
            </ToggleButton>
        </Grid>
    </Border>
</UserControl>
